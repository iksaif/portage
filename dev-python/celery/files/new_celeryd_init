#!/sbin/runscript
 
depend() {
	need net rabbitmq 
	after apache rabbitmq
}

if [ "${START_CELERYBEAT_TOO}" = "yes" ]; then
	CELERYD_OPTS="$CELERYD_OPTS --beat"
fi

if [ -n "${DJANGO_SETTINGS_MODULE}" ]; then
	DJANGO_OPTS="$DJANGO_OPTS --settings=${DJANGO_SETTINGS_MODULE}"
fi

# Extra start-stop-daemon options, like user/group.
if [ -n "$CELERYD_USER" ]; then
    DAEMON_OPTS="$DAEMON_OPTS --chuid $CELERYD_USER"
fi
if [ -n "$CELERYD_GROUP" ]; then
    DAEMON_OPTS="$DAEMON_OPTS --group $CELERYD_GROUP"
fi

if [ -n "$CELERYD_CHDIR" ]; then
    DAEMON_OPTS="$DAEMON_OPTS --chdir $CELERYD_CHDIR"
fi

CELERYD_OPTS="$CELERYD_OPTS -f $CELERYD_LOG_FILE -l $CELERYD_LOG_LEVEL"


start() {
			ebegin "Starting CeleryD"
			start-stop-daemon --start --background \
				${DAEMON_OPTS} \
				--make-pidfile \
				--pidfile ${CELERYD_PIDFILE} \
				--exec ${CELERYD_BINARY} -- ${CELERYD_OPTS}
			eend $?	
}

stop() {
			ebegin "Stopping CeleryD"
			start-stop-daemon --stop --quiet --pidfile ${CELERYD_PIDFILE}
			rm -f "${CELERYD_PIDFILE}"
			eend $?
}
